<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"></meta>

        <title>Ring</title>
        <h:outputScript library="js" name="jquery-1.8.1.min.js" />
        <h:outputScript library="js" name="processing-1.4.1.js" />
        <h:outputScript library="js" name="kinetic-v4.0.2.min.js" />
        <h:outputScript library="js" name="kineticCircleJS.js" />

        <script type="text/javascript">
            //<![CDATA[

            $(function(){

                var json = '#{reportBean.json}';
                addSegments(json);
            


                var timer = 0,
                timeout = 3000,

                memPDF = setInterval(function () {
                    var sketchPDF = Processing.getInstanceById("canvasPDF");
                    if (sketchPDF) {
                        console.log("SKETCH PDF HAS LOADED");
                        clearInterval(memPDF);
                        var json = '#{reportBean.json}';
                        var data = $.parseJSON(json);
                        if(data) {
                            for(i=0; i<data.length; i++) {
                                var segment = data[i];
                                sketchPDF.addSegment(segment.label, segment.count,segment.isMain);
                            }
                        }
                    } else {
                        timer += 10;
                        if (timer > timeout) {
                            console.log("FAILED TO LOAD SKETCH");
                            clearInterval(memPDF);
                        }
                    }
                }, 10);
                
                
            }); //end ready

            //]]>
        </script>

        <script type="text/javascript">
            function handleOutcome(event){
                var canvas = document.getElementById("canvasPDF");
                var dataURL    = canvas.toDataURL("image/png");
                var hidden = document.getElementById('form:dataURL');
                hidden.value = dataURL;

            }
        </script>

    </h:head>
    <h:body>



        <h1>Report for #{controllerBean.forename} #{controllerBean.surname}</h1>

        <h:form id ="form">
            <h:inputHidden id="dataURL" value="#{fileDownloadController.dataURL}" />

            <p:commandButton id="downloadLink" value="Download" ajax="false" onclick ="handleOutcome();"   
                             icon="ui-icon-arrowthichk-s">  
                <p:fileDownload value="#{fileDownloadController.file}" />  
            </p:commandButton>  

        </h:form>

        <h:form id="form2">
            <h:inputHidden id="nameClicked" value="reportBean.nameClicked"/>
            <h:commandButton id="submitNameClicked" onclick="confirmation.show()" type="button"/>
        </h:form>

        <div id ="laius">
            <p>#{controllerBean.forename} #{controllerBean.surname} is the author of <b>#{controllerBean.nbMendeleyDocs} papers</b>.</p>
            <p>His or her most frequent co-author is <b>#{controllerBean.mostFrequentCoAuthor.fullname}</b>.<br></br>
                Together, they wrote #{controllerBean.mostFrequentCoAuthor.timesMentioned} papers in the years from #{controllerBean.mostFrequentCoAuthor.yearFirstCollab} to #{controllerBean.mostFrequentCoAuthor.yearLastCollab}.</p>
        </div>

        <div id="container"></div>

        <!--<canvas id ="canvasPage" data-processing-sources="processingSketchForScreen.pde" width="300"></canvas>-->
        <canvas id ="canvasPDF" style="display:none" data-processing-sources="processingSketchForPDF.pde"></canvas>

<!--        <p:confirmDialog id="confirmDialog" message="Are you sure about destroying the world?"  
                         header="Initiating destroy process" severity="alert" widgetVar="confirmation">  

            <p:commandButton id="confirm" value="Yes Sure" update="messages" oncomplete="confirmation.hide()"/>  
            <p:commandButton id="decline" value="Not Yet" onclick="confirmation.hide()" type="button" />   

        </p:confirmDialog>  -->

    </h:body>
</html>

